<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Pest Identifier | Hanson Pest & Wildlife</title>
  <meta name="description" content="Free AI-powered pest identification. Upload a photo and get instant pest identification with treatment recommendations.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root { --navy: #0f172a; --navy-light: #1e293b; --gold: #f59e0b; --gold-dark: #d97706; --green: #10b981; --blue: #3b82f6; --red: #ef4444; --white: #ffffff; --gray: #94a3b8; }
    body { font-family: 'Outfit', sans-serif; background: var(--navy); color: var(--white); line-height: 1.6; min-height: 100vh; }
    
    .header { background: linear-gradient(180deg, var(--navy) 0%, var(--navy-light) 100%); padding: 20px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .header-inner { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit; }
    .logo-icon { font-size: 36px; }
    .logo-text h1 { font-size: 24px; font-weight: 800; letter-spacing: 2px; }
    .logo-text span { font-size: 11px; color: var(--gray); letter-spacing: 3px; }
    .header-cta { display: flex; gap: 12px; align-items: center; }
    .phone-link { color: var(--gold); text-decoration: none; font-weight: 600; font-size: 18px; }
    .btn-primary { background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%); color: var(--navy); padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 700; transition: transform 0.2s; border: none; cursor: pointer; font-family: inherit; font-size: 16px; }
    .btn-primary:hover { transform: translateY(-2px); }
    .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

    .main { max-width: 800px; margin: 0 auto; padding: 48px 20px; }
    
    .page-header { text-align: center; margin-bottom: 48px; }
    .page-header h2 { font-size: clamp(28px, 5vw, 42px); font-weight: 800; margin-bottom: 16px; }
    .page-header h2 span { color: var(--gold); }
    .page-header p { color: var(--gray); font-size: 18px; max-width: 500px; margin: 0 auto; }

    .upload-section { background: var(--navy-light); border-radius: 24px; padding: 48px 32px; border: 2px dashed rgba(255,255,255,0.2); text-align: center; transition: border-color 0.3s, background 0.3s; margin-bottom: 32px; }
    .upload-section.dragover { border-color: var(--gold); background: rgba(245, 158, 11, 0.05); }
    .upload-section.has-image { border-style: solid; border-color: var(--green); }

    .upload-icon { font-size: 64px; margin-bottom: 16px; opacity: 0.8; }
    .upload-section h3 { font-size: 24px; margin-bottom: 8px; }
    .upload-section p { color: var(--gray); margin-bottom: 24px; }
    
    .upload-btn { display: inline-block; }
    .file-input { display: none; }
    
    .preview-container { display: none; margin-bottom: 24px; }
    .preview-container.visible { display: block; }
    .preview-image { max-width: 100%; max-height: 400px; border-radius: 16px; margin-bottom: 16px; }
    .preview-info { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: rgba(0,0,0,0.2); border-radius: 8px; }
    .preview-name { color: var(--gray); font-size: 14px; }
    .remove-btn { background: var(--red); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-family: inherit; font-weight: 600; font-size: 14px; }

    .analyze-section { text-align: center; margin-bottom: 32px; }
    
    .results-section { display: none; }
    .results-section.visible { display: block; }
    
    .result-card { background: var(--navy-light); border-radius: 20px; padding: 32px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 24px; }
    .result-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .result-icon { font-size: 48px; }
    .result-title h3 { font-size: 28px; color: var(--gold); margin-bottom: 4px; }
    .result-title p { color: var(--gray); font-size: 14px; }
    
    .confidence-bar { margin-bottom: 24px; }
    .confidence-label { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
    .confidence-track { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
    .confidence-fill { height: 100%; background: linear-gradient(90deg, var(--green) 0%, var(--gold) 100%); border-radius: 4px; transition: width 0.5s ease-out; }

    .result-details { display: grid; gap: 20px; }
    .detail-item { background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; }
    .detail-item h4 { color: var(--gold); font-size: 14px; letter-spacing: 1px; margin-bottom: 8px; text-transform: uppercase; }
    .detail-item p { color: var(--white); line-height: 1.7; }
    .detail-item ul { color: var(--white); padding-left: 20px; }
    .detail-item li { margin-bottom: 8px; }

    .estimate-box { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%); border: 1px solid var(--green); border-radius: 16px; padding: 24px; text-align: center; margin-top: 24px; }
    .estimate-box h4 { color: var(--green); margin-bottom: 8px; }
    .estimate-price { font-size: 36px; font-weight: 800; margin-bottom: 8px; }
    .estimate-note { color: var(--gray); font-size: 14px; }

    .cta-box { background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%); border-radius: 16px; padding: 32px; text-align: center; }
    .cta-box h4 { color: var(--navy); font-size: 24px; margin-bottom: 8px; }
    .cta-box p { color: var(--navy); opacity: 0.8; margin-bottom: 20px; }
    .cta-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
    .btn-dark { background: var(--navy); color: var(--white); padding: 14px 28px; border-radius: 8px; text-decoration: none; font-weight: 700; }
    .btn-outline-dark { background: transparent; color: var(--navy); padding: 14px 28px; border-radius: 8px; text-decoration: none; font-weight: 700; border: 2px solid var(--navy); }

    .loading { display: none; align-items: center; justify-content: center; gap: 12px; padding: 20px; }
    .loading.visible { display: flex; }
    .spinner { width: 24px; height: 24px; border: 3px solid rgba(255,255,255,0.2); border-top-color: var(--gold); border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .error-message { background: rgba(239, 68, 68, 0.2); border: 1px solid var(--red); color: var(--white); padding: 16px 20px; border-radius: 12px; margin-bottom: 24px; display: none; }
    .error-message.visible { display: block; }

    .back-link { display: inline-flex; align-items: center; gap: 8px; color: var(--gray); text-decoration: none; margin-bottom: 24px; font-size: 14px; }
    .back-link:hover { color: var(--white); }

    @media (max-width: 768px) {
      .header-inner { flex-direction: column; gap: 16px; }
      .phone-link { display: none; }
      .upload-section { padding: 32px 20px; }
      .result-header { flex-direction: column; text-align: center; }
      .cta-buttons { flex-direction: column; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="/" class="logo">
        <span class="logo-icon">ü¶ù</span>
        <div class="logo-text">
          <h1>HANSON</h1>
          <span>PEST & WILDLIFE</span>
        </div>
      </a>
      <div class="header-cta">
        <a href="tel:+19189216913" class="phone-link">üìû (918) 921-6913</a>
        <a href="https://clienthub.getjobber.com/booking/2d41cb32-b8bd-404e-ba90-e86c72bfd527" class="btn-primary">Book Now</a>
      </div>
    </div>
  </header>

  <main class="main">
    <a href="/" class="back-link">‚Üê Back to Home</a>
    
    <div class="page-header">
      <h2>ü§ñ <span>AI Pest</span> Identifier</h2>
      <p>Upload a photo of any pest, droppings, or damage and get instant identification with treatment recommendations.</p>
    </div>

    <div class="error-message" id="error"></div>

    <div class="upload-section" id="dropZone">
      <div class="preview-container" id="previewContainer">
        <img id="previewImage" class="preview-image" alt="Preview">
        <div class="preview-info">
          <span class="preview-name" id="fileName"></span>
          <button class="remove-btn" id="removeBtn">Remove</button>
        </div>
      </div>
      <div id="uploadPrompt">
        <div class="upload-icon">üì∏</div>
        <h3>Upload a Photo</h3>
        <p>Drag and drop an image here, or click to select</p>
        <label class="btn-primary upload-btn">
          Choose File
          <input type="file" class="file-input" id="fileInput" accept="image/*">
        </label>
      </div>
    </div>

    <div class="analyze-section" id="analyzeSection">
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <span>Analyzing your image...</span>
      </div>
      <button class="btn-primary" id="analyzeBtn" style="display: none; padding: 16px 48px; font-size: 18px;">
        üîç Identify This Pest
      </button>
    </div>

    <div class="results-section" id="results">
      <div class="result-card">
        <div class="result-header">
          <span class="result-icon" id="resultIcon">üêú</span>
          <div class="result-title">
            <h3 id="pestName">Loading...</h3>
            <p id="scientificName">Scientific name</p>
          </div>
        </div>

        <div class="confidence-bar">
          <div class="confidence-label">
            <span>Identification Confidence</span>
            <span id="confidencePercent">0%</span>
          </div>
          <div class="confidence-track">
            <div class="confidence-fill" id="confidenceFill" style="width: 0%"></div>
          </div>
        </div>

        <div class="result-details">
          <div class="detail-item">
            <h4>üîé Description</h4>
            <p id="description">Loading...</p>
          </div>
          <div class="detail-item">
            <h4>‚ö†Ô∏è Risks & Concerns</h4>
            <p id="risks">Loading...</p>
          </div>
          <div class="detail-item">
            <h4>üõ†Ô∏è Recommended Treatment</h4>
            <p id="treatment">Loading...</p>
          </div>
          <div class="detail-item">
            <h4>üè† Prevention Tips</h4>
            <ul id="prevention"></ul>
          </div>
        </div>

        <div class="estimate-box">
          <h4>üí∞ Estimated Treatment Cost</h4>
          <div class="estimate-price" id="priceRange">$100 - $200</div>
          <p class="estimate-note">Final price depends on infestation severity and property size</p>
        </div>
      </div>

      <div class="cta-box">
        <h4>Ready to Get Rid of Your Pest Problem?</h4>
        <p>Book a professional inspection and treatment today.</p>
        <div class="cta-buttons">
          <a href="https://clienthub.getjobber.com/booking/2d41cb32-b8bd-404e-ba90-e86c72bfd527" class="btn-dark">üìÖ Book Service</a>
          <a href="tel:+19189216913" class="btn-outline-dark">üìû (918) 921-6913</a>
        </div>
      </div>

      <div style="text-align: center; margin-top: 24px;">
        <button class="btn-primary" id="newAnalysis" style="background: var(--navy-light); color: var(--white); border: 1px solid rgba(255,255,255,0.2);">
          üîÑ Analyze Another Image
        </button>
      </div>
    </div>
  </main>

  <script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const previewContainer = document.getElementById('previewContainer');
    const previewImage = document.getElementById('previewImage');
    const fileName = document.getElementById('fileName');
    const uploadPrompt = document.getElementById('uploadPrompt');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');
    const errorDiv = document.getElementById('error');
    const removeBtn = document.getElementById('removeBtn');
    const newAnalysisBtn = document.getElementById('newAnalysis');

    let currentFile = null;
    let imageBase64 = null;

    // Drag and drop handlers
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0 && files[0].type.startsWith('image/')) {
        handleFile(files[0]);
      }
    });

    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleFile(e.target.files[0]);
      }
    });

    removeBtn.addEventListener('click', resetUpload);
    newAnalysisBtn.addEventListener('click', resetUpload);

    function handleFile(file) {
      currentFile = file;
      fileName.textContent = file.name;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImage.src = e.target.result;
        imageBase64 = e.target.result.split(',')[1];
        previewContainer.classList.add('visible');
        uploadPrompt.style.display = 'none';
        dropZone.classList.add('has-image');
        analyzeBtn.style.display = 'inline-block';
        results.classList.remove('visible');
        errorDiv.classList.remove('visible');
      };
      reader.readAsDataURL(file);
    }

    function resetUpload() {
      currentFile = null;
      imageBase64 = null;
      fileInput.value = '';
      previewContainer.classList.remove('visible');
      uploadPrompt.style.display = 'block';
      dropZone.classList.remove('has-image');
      analyzeBtn.style.display = 'none';
      results.classList.remove('visible');
      errorDiv.classList.remove('visible');
    }

    analyzeBtn.addEventListener('click', async () => {
      if (!imageBase64) return;

      analyzeBtn.style.display = 'none';
      loading.classList.add('visible');
      errorDiv.classList.remove('visible');

      try {
        const response = await fetch('https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            model: 'claude-sonnet-4-20250514',
            max_tokens: 1000,
            messages: [{
              role: 'user',
              content: [
                {
                  type: 'image',
                  source: {
                    type: 'base64',
                    media_type: currentFile.type,
                    data: imageBase64
                  }
                },
                {
                  type: 'text',
                  text: `You are a pest identification expert for Hanson Pest & Wildlife in Eastern Oklahoma. Analyze this image and identify any pest, insect, rodent, wildlife, or signs of infestation (droppings, damage, nests, etc.).

Respond ONLY with valid JSON in this exact format (no markdown, no backticks):
{
  "identified": true,
  "pestName": "Common name of the pest",
  "scientificName": "Scientific/Latin name",
  "icon": "Single emoji representing this pest",
  "confidence": 85,
  "description": "2-3 sentence description of what this pest is and its characteristics",
  "risks": "2-3 sentences about health risks, property damage, or concerns",
  "treatment": "2-3 sentences about professional treatment methods",
  "prevention": ["Prevention tip 1", "Prevention tip 2", "Prevention tip 3", "Prevention tip 4"],
  "priceRange": "$150 - $300",
  "category": "general_pest|rodent|wildlife|stinging|bed_bug|termite|snake"
}

If the image does not show a pest, insect, animal, or signs of infestation, respond with:
{
  "identified": false,
  "message": "Brief explanation of what you see instead"
}

Base pricing on these Hanson Pest & Wildlife rates:
- General Pest Control: From $100
- Rodent Control: From $150  
- Stinging Insects: From $150
- Wildlife Removal: From $200
- Squirrel Exclusion: From $200
- Snake Removal: From $150
- Bed Bug Treatment: From $350
- Termite Protection: From $500`
                }
              ]
            }]
          })
        });

        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error.message || 'API error occurred');
        }

        const textContent = data.content.find(c => c.type === 'text');
        if (!textContent) {
          throw new Error('No response from AI');
        }

        // Parse the JSON response
        const cleanedText = textContent.text.replace(/```json\n?|\n?```/g, '').trim();
        const result = JSON.parse(cleanedText);

        if (!result.identified) {
          errorDiv.textContent = 'ü§î ' + (result.message || "This doesn't appear to be a pest. Please upload a clear photo of a pest, insect, rodent, or signs of infestation.");
          errorDiv.classList.add('visible');
          analyzeBtn.style.display = 'inline-block';
        } else {
          displayResults(result);
        }

      } catch (error) {
        console.error('Error:', error);
        errorDiv.textContent = '‚ùå Error analyzing image: ' + error.message + '. Please try again.';
        errorDiv.classList.add('visible');
        analyzeBtn.style.display = 'inline-block';
      } finally {
        loading.classList.remove('visible');
      }
    });

    function displayResults(result) {
      document.getElementById('resultIcon').textContent = result.icon || 'üêõ';
      document.getElementById('pestName').textContent = result.pestName;
      document.getElementById('scientificName').textContent = result.scientificName;
      document.getElementById('confidencePercent').textContent = result.confidence + '%';
      document.getElementById('confidenceFill').style.width = result.confidence + '%';
      document.getElementById('description').textContent = result.description;
      document.getElementById('risks').textContent = result.risks;
      document.getElementById('treatment').textContent = result.treatment;
      document.getElementById('priceRange').textContent = result.priceRange;

      const preventionList = document.getElementById('prevention');
      preventionList.innerHTML = '';
      result.prevention.forEach(tip => {
        const li = document.createElement('li');
        li.textContent = tip;
        preventionList.appendChild(li);
      });

      results.classList.add('visible');
      results.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  </script>
</body>
</html>
